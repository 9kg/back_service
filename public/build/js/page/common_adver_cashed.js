$(function(){var e,t,a=base.calDate("d",-30,new Date),n=$(".date_start").val(base.date("y-m-d",a)).datepicker({timepicker:!1,max:"today",min:"2016-07-20",datetime:a}),r=$(".date_end").val(base.now("y-m-d")).datepicker({timepicker:!1,min:a,max:"today"}),d=new Box({title:"申请打款",html:"http://es2.laizhuan.com/back/page/adver_cashed_add .adver_cashed_form",css:{"min-width":"320px","max-width":"420px"},fnSure:function(e,a){var n=$("form.adver_cashed");if(!base.formValidate(n))return!1;var r=n.serializeArray();$.ajax({url:"http://es2.laizhuan.com/back/finance/adver_cash_request",dataType:"json",data:r}).done(function(e){1==e.status?(t.operTip(e.msg||"操作成功!",{theme:"success",dir:"left",css:{"white-space":"nowrap"}}),setTimeout(function(){renderTable()},1e3)):t.operTip(e.msg||"操作失败!",{theme:"danger",dir:"left",css:{"white-space":"nowrap"}})}).fail(function(e){t.operTip("操作失败!",{theme:"danger",dir:"left",css:{"white-space":"nowrap"}})})},fnCancel:function(e){}}),i={$ct:$(".content"),col:[{key:"company",title:"广告主",sort:!0,filter:!0},{key:"fee",title:"金额",sort:!0,filter:!0},{key:"dealing_money",title:"预扣",sort:!0,filter:!0}],isLocal:!0,url:"http://es2.laizhuan.com/back/finance/adver_cashed",sendData:{sdate:$(".date_start").val(),edate:$(".date_end").val()},fnAfterData:function(t){e=t&&t.data},fnAfterRender:function(){$(".filter_type").eq(1).trigger("click")}};5!==role&&7!==role||i.col.push({key:"source_id",title:"操作",width:60,cls:"t_center",render:function(e,t,a,n){var r=$('<button type="button" class="btn btn_info btn_request" data-id="'+t+'">申请</button>');0==n.type&&(r=$('<span class="btn">预付</span>')),e.append(r)}});var c=new Table(i);window.renderTable=function(){c.data=null,c.render()},$("body").on("click","table .btn_request",function(){t=$(this).parent();var e=$(this).data("id");d.initContent("http://es2.laizhuan.com/back/page/adver_cashed_add .adver_cashed_form",function(){$("form.adver_cashed").prepend($('<input type="hidden" name="ad_id" value="'+e+'"/>')),d.show()})}).on("change",".date_start",function(){r.cgOpt({min:$(this).val()}),c.sendData.sdate=$(".date_start").val(),renderTable()}).on("change",".date_end",function(){n.cgOpt({max:$(this).val()}),c.sendData.edate=$(".date_end").val(),renderTable()}).on("click",".filter_type",function(){if(!e)return!1;var t=$(".filter_type:checked").val();0==t?c.col[c.col.length-1].show=!1:c.col[c.col.length-1].show=!0,c.data=$.map(e,function(e){return e.type==t?e:void 0}),c.render()})});