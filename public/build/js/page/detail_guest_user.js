$(function(){var e=$(".btn_edit").parent(),a=new Box({title:"修改特邀用户",html:"http://es2.laizhuan.com/back/page/guest_user_add .add_guest_user_form",css:{"min-width":"200px"},fnSure:function(a,t){var n=$(".add_guest_user"),r=$('[name="fee_date"]'),s=+r.val();if(!base.formValidate(n))return!1;if(!$(".charge_type:checked").length&&!s)return $(".btn_radios").parent().operTip("请至少选填一项推广费用！",{theme:"danger",dir:"top",css:{"white-space":"nowrap"}}),!1;r.val($('[name="charge_by_date"]:checked').val()+"_"+s),$('[name="charge_by_date"]').prop("disabled",!0);var i=$(".add_guest_user").serializeArray();$('[name="fans_num"]').prop("disabled")&&i.push({name:"fans_num",value:null}),$('[name="fee_date"]').prop("disabled")&&i.push({name:"fee_date",value:null}),$('[name="fee_per"]').prop("disabled")&&i.push({name:"fee_per",value:null}),$('[name="fee_other"]').prop("disabled")&&i.push({name:"fee_other",value:null}),$('[name="can_withdraw"]').prop("checked")||i.push({name:"can_withdraw",value:0}),r.val(s),$('[name="charge_by_date"]').prop("disabled",!1),$.ajax({url:"http://es2.laizhuan.com/back/guest_user/modify",type:"POST",dataType:"json",data:i}).done(function(a){1===a.status?(e.operTip(a.msg||"操作成功！",{theme:"success",css:{left:"auto",right:"20px","white-space":"nowrap"}}),window.opener&&window.opener.renderTable&&window.opener.renderTable(),setTimeout(function(){window.location.href=window.location.href},500)):e.operTip(a.msg||"操作失败！",{theme:"danger",css:{left:"auto",right:"20px","white-space":"nowrap"}})}).fail(function(a){e.operTip(data.msg||"操作失败！",{theme:"danger",css:{left:"auto",right:"20px","white-space":"nowrap"}})})},fnCancel:function(e){}}),t=new Tip({$ct:$(".details").eq(0),confirm:!0,content:"您确定要删除当前特邀用户？",isShow:!1,theme:"warning",dir:"bottom",css:{width:"9em"},alertfn:function(a){a&&$.ajax({url:"http://es2.laizhuan.com/back/guest_user/remove",type:"POST",dataType:"json",data:{id:guest_user_data.id}}).done(function(a){1===a.status?(e.operTip(a.msg||"操作成功！",{theme:"success",css:{left:"auto",right:"20px","white-space":"nowrap"}}),window.opener&&window.opener.renderTable&&window.opener.renderTable(),setTimeout(function(){window.close()},500)):e.operTip(a.msg||"操作失败！",{theme:"danger",css:{left:"auto",right:"20px","white-space":"nowrap"}})}).fail(function(a){e.operTip(data.msg||"操作失败！",{theme:"danger",css:{left:"auto",right:"20px","white-space":"nowrap"}})})}});console.dir(guest_user_data),$("body").on("click",".btn_edit",function(){a.initContent("http://es2.laizhuan.com/back/page/guest_user_add .add_guest_user_form",function(){$('[name="uid"]').val(guest_user_data.id).attr("name","id"),$('[name="type"]').val(guest_user_data._type).trigger("change"),$('[name="fans_num"]').val(guest_user_data._fans_num),$('[name="name"]').val(guest_user_data.name),$('[name="alipay"]').val(guest_user_data.alipay),$('[name="fee_date"]').val(guest_user_data._fee_date),$('[name="charge_by_date"][value="'+guest_user_data.charge_by_date+'"]').trigger("click"),$('[name="can_withdraw"]').prop("checked",!!guest_user_data.can_withdraw),guest_user_data.fee_per&&($(".charge_type").eq(0).trigger("click"),$('[name="fee_per"]').val(guest_user_data.fee_per)),guest_user_data.fee_other&&($(".charge_type").eq(1).trigger("click"),$('[name="fee_other"]').val(guest_user_data.fee_other)),a.show()})}).on("click",".btn_remove",function(){t.init(),t.show()}).on("change",'.add_guest_user_form select[name="type"]',function(){$(this).validate(function(){return $(this).val()},"该字段必填！",{dir:"bottom"})}).on("change",'select[name="type"]',function(){var e=$(this).val();$(".fans_num_ct").toggleClass("hidden","anchor"!==e&&"microblog"!==e),$(".fans_num_ct").find(":input").prop("disabled",!0),$(".fans_num_ct").find(":input").not(".hidden :input,:input.hidden").prop("disabled",!1)})});